<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>심플 웹 에디터</title>
  <style>
    body {
      max-width: 900px;
      margin: 40px auto;
      font-family: "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      line-height: 1.6;
    }
    h1 {
      margin-bottom: 1rem;
    }
    .toolbar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }
    .toolbar select,
    .toolbar button {
      padding: 0.35rem 0.6rem;
      font-size: 0.95rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
    }
    .toolbar button:hover,
    .toolbar select:hover {
      background: #f0f0f0;
    }
    #editor {
      width: 100%;
      min-height: 220px;
      padding: 1rem;
      border: 1px solid #aaa;
      border-radius: 6px;
      resize: vertical;
      overflow: auto;
      outline: none;
    }
    #output {
      margin-top: 1rem;
      padding: 0.75rem;
      border: 1px solid #ddd;
      background: #fafafa;
      white-space: pre-wrap;
      font-family: "Menlo", "Consolas", monospace;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>샘플 웹 에디터</h1>

  <!-- 툴바 -->
  <div class="toolbar">
    <button type="button" data-cmd="bold"><strong>B</strong></button>
    <button type="button" data-cmd="italic"><em>I</em></button>
    <button type="button" data-cmd="underline"><u>U</u></button>

    <select id="colorPicker">
      <option value="initial">색상</option>
      <option value="#000000">검정</option>
      <option value="#d32f2f">빨강</option>
      <option value="#1976d2">파랑</option>
    </select>

    <select id="blockStyle">
      <option value="p">본문 (P)</option>
      <option value="h1">스타일 1 (H1)</option>
      <option value="h2">스타일 2 (H2)</option>
      <option value="h3">스타일 3 (H3)</option>
    </select>

    <button type="button" id="saveBtn">저장</button>
  </div>

  <!-- 에디터 영역 -->
  <div id="editor" contenteditable="true" spellcheck="true">
    여기에 글을 입력하세요 ✍️
  </div>

  <!-- 결과 HTML -->
  <pre id="output" hidden></pre>

  <script>
    // 범용 Inline 스타일 적용 함수
    function applyInline(tagName, styleObj = {}) {
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0);
      if (range.collapsed) return; // 선택된 글자가 없으면 중단

      // 이미 같은 태그로 감싸져 있다면 토글처럼 제거하도록 처리 (간단 구현)
      const parentTag = sel.anchorNode.parentElement;
      if (parentTag && parentTag.tagName.toLowerCase() === tagName.toLowerCase()) {
        parentTag.replaceWith(...parentTag.childNodes);
        return;
      }

      const wrapper = document.createElement(tagName);
      Object.assign(wrapper.style, styleObj);
      range.surroundContents(wrapper);
      sel.removeAllRanges();
      sel.addRange(range);
    }

    // 블록(문단/제목) 스타일 적용 함수
    function applyBlock(tagName) {
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0);
      let block = sel.anchorNode;

      // 선택된 노드에서 최상위 블록 요소를 찾음
      while (block && block !== document && !/^(p|h1|h2|h3|div)$/i.test(block.tagName)) {
        block = block.parentNode;
      }
      if (!block || block.id === "editor") {
        // 새 블록 생성
        const newBlock = document.createElement(tagName);
        newBlock.appendChild(range.extractContents());
        range.insertNode(newBlock);
      } else if (block.tagName.toLowerCase() === tagName.toLowerCase()) {
        // 같은 태그면 P로 토글
        const p = document.createElement("p");
        p.innerHTML = block.innerHTML;
        block.replaceWith(p);
      } else {
        // 태그 변경
        const newBlock = document.createElement(tagName);
        newBlock.innerHTML = block.innerHTML;
        block.replaceWith(newBlock);
      }
    }

    // 이벤트 바인딩
    document.querySelectorAll("[data-cmd]").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const cmd = e.currentTarget.dataset.cmd;
        if (cmd === "bold") applyInline("b");
        if (cmd === "italic") applyInline("i");
        if (cmd === "underline") applyInline("span", { textDecoration: "underline" });
      });
    });

    document.getElementById("colorPicker").addEventListener("change", (e) => {
      const color = e.target.value;
      if (color === "initial") return;
      applyInline("span", { color });
      e.target.selectedIndex = 0; // 초기화
    });

    document.getElementById("blockStyle").addEventListener("change", (e) => {
      const tag = e.target.value;
      applyBlock(tag);
    });

    // 저장 버튼 → HTML 결과 표시
    document.getElementById("saveBtn").addEventListener("click", () => {
      const html = document.getElementById("editor").innerHTML.trim();
      const output = document.getElementById("output");
      output.textContent = html || "(빈 내용)";
      output.hidden = false;
    });
  </script>
</body>
</html>
